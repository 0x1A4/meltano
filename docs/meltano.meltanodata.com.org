* TODO Infrastructure

** TODO DNS

*** DONE Buy the domain name (meltanodata.com)
*** TODO Setup the nameservers on DigitalOcean
*** TODO Register meltano.meltanodata.com

Create "A" Record to the Compute IP

** DONE Compute

*** DigitalOcean 2vCPU/4GB

ulimit -n 8192

** TODO Database

*** DigitalOcean PostgreSQL 1vCPU 25GB

**** TODO With DigitalOcean API

* TODO Meltano

** DONE Create the instance

*** DONE 165.227.23.155

**** With DigitalOcean API

curl -X POST -H 'Content-Type: application/json' \
     -H 'Authorization: Bearer '$TOKEN'' -d \
    '{"name":"choose_a_name","region":"sfo2","size":"s-2vcpu-4gb","image":"gitlab-meltano-18-04"}' \
    "https://api.digitalocean.com/v2/droplets"

Docs:

https://www.digitalocean.com/docs/api
https://www.digitalocean.com/docs/api/create-personal-access-token/

** DONE TLS/HTTPS

*** DONE Setup Caddy with Let's Encrypt

# install caddy
curl https://getcaddy.com

# create the Caddyfile
```
<subdomain>.meltanodata.com

proxy / localhost:5000 {
  transparent
}

tls admin@meltano.com
```

# run caddy
caddy -conf /path/to/Caddyfile

*** DONE Make a systemd unit for caddy

https://github.com/caddyserver/caddy/tree/master/dist/init/linux-systemd


** DONE Local testing

https://tobias.is/blogging/test-http2-localhost-caddy-ssl/

Caddyfile
```
localhost.localdomain:1443

proxy / localhost:5000 {
  transparent
}

tls self_signed
```

** TODO Setup Gitlab models
** TODO Setup Google Analytics models
** TODO Setup Orchestration (daily runs)


* DONE Maintenance

** DONE Setup FTP server

useradd -d /var/meltano/project -M meltano_ftp -g meltano

*** TODO Setup a password for `meltano_ftp`

passwd meltano_ftp

** TODO Setup ACLs (security)

cd /var/meltano/project

find . -path ./.meltano -prune -o -type f -exec chmod 620 {} \;
find . -path ./.meltano -prune -o -type d -exec chmod 770 {} \;

** TODO Setup htpasswd

apt-get install apache2-utils

htpasswd -b /etc/caddy/htpasswd meltano <password>
passwd meltano_ftp <password>
